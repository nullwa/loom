import { Meta, Markdown } from '@storybook/addon-docs/blocks'

<Meta title='Utils/use-clipboard' />

# use-clipboard

<p>
A React hook for copying text to the clipboard.  
It provides a `copied` state to indicate success and a `copy` function to trigger copying.

This hook uses the modern Clipboard API when available, with a fallback to `document.execCommand` for older browsers.

</p>

## Features

- üîÑ **Automatic Fallback**: Uses modern Clipboard API with execCommand fallback
- üéØ **Optional ID Tracking**: Track multiple copy operations with identifiers
- ‚è±Ô∏è **Configurable Timeout**: Visual feedback state that auto-resets
- üîí **Secure Context Aware**: Handles non-HTTPS environments gracefully
- üì± **Cross-Browser Compatible**: Works in modern and legacy browsers

## Installation

```tsx
// Copy the hook to your project
import { useClipboard } from './hooks/useClipboard'
```

## Basic Usage

```tsx
function CopyButton() {
  const { copied, copy } = useClipboard()

  return <button onClick={() => copy('Hello World!')}>{copied ? 'Copied!' : 'Copy Text'}</button>
}
```

## API Reference

#### **Return Value**

<Markdown className='w-full'>
  {`
| Property | Type | Description |
|----------|------|-------------|
| \`copied\` | \`boolean \\| string\` | Current copied state. \`false\` when nothing copied, \`true\` for basic copies, or the \`id\` string when using identifiers |
| \`copy\` | \`function\` | Async function to copy text to clipboard |
  `}
</Markdown>

#### **copy Function**

```ts
copy(text: string, id?: string): Promise<{
  success: boolean
  error?: Error
}>
```

<Markdown className='w-full'>
  {`
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| \`text\` | \`string\` | Yes | The text to copy to clipboard |
| \`id\` | \`string\` | No | Optional identifier to track which text was copied |
  `}
</Markdown>

## Examples

#### **Basic Copy**

```tsx
function BasicExample() {
  const { copied, copy } = useClipboard()

  return <button onClick={() => copy('Basic text to copy')}>{copied ? '‚úÖ Copied!' : 'üìã Copy'}</button>
}
```

#### **Multiple Copy Buttons with IDs**

```tsx
function MultipleButtonsExample() {
  const { copied, copy } = useClipboard()

  const items = [
    { id: 'email', text: 'user@example.com', label: 'Email' },
    { id: 'phone', text: '+1 (555) 123-4567', label: 'Phone' },
    { id: 'address', text: '123 Main St, City, State 12345', label: 'Address' },
  ]

  return (
    <div className='space-y-2'>
      {items.map((item) => (
        <div key={item.id} className='flex items-center gap-2'>
          <span>{item.text}</span>
          <button onClick={() => copy(item.text, item.id)} className='px-2 py-1 bg-blue-500 text-white rounded'>
            {copied === item.id ? 'Copied!' : `Copy ${item.label}`}
          </button>
        </div>
      ))}
    </div>
  )
}
```

#### **Error Handling**

```tsx
function ErrorHandlingExample() {
  const { copied, copy } = useClipboard()
  const [error, setError] = useState<string | null>(null)

  const handleCopy = async (text: string) => {
    const result = await copy(text)

    if (!result.success) {
      setError(result.error?.message || 'Failed to copy')
      setTimeout(() => setError(null), 3000)
    } else {
      setError(null)
    }
  }

  return (
    <div>
      <button onClick={() => handleCopy('Text to copy')}>{copied ? 'Copied!' : 'Copy with Error Handling'}</button>
      {error && <div className='text-red-500 mt-2'>Error: {error}</div>}
    </div>
  )
}
```

#### **Code Block with Copy**

```tsx
function CodeBlockExample() {
  const { copied, copy } = useClipboard()

  const codeSnippet = `import { useClipboard } from './hooks/useClipboard'

function MyComponent() {
  const { copied, copy } = useClipboard()
  
  return (
    <button onClick={() => copy("Hello!")}>
      {copied ? "Copied!" : "Copy"}
    </button>
  )
}`

  return (
    <div className='relative'>
      <pre className='bg-gray-100 p-4 rounded overflow-x-auto'>
        <code>{codeSnippet}</code>
      </pre>
      <button onClick={() => copy(codeSnippet)} className='absolute top-2 right-2 bg-white border rounded px-2 py-1 text-sm'>
        {copied ? '‚úÖ' : 'üìã'}
      </button>
    </div>
  )
}
```

## Configuration

#### **Custom Timeout**

The default timeout is 2000ms. To customize this, modify the `DEFAULT_TIMEOUT` constant:

```tsx
const DEFAULT_TIMEOUT = 3000 // 3 seconds
```

#### **TypeScript Support**

The hook is fully typed with automatic inference:

```tsx
const { copied, copy } = useClipboard()
// copied: boolean | string
// copy: (text: string, id?: string) => Promise<{success: boolean, error?: Error}>
```

## Browser Support

- **Modern browsers**: Uses Clipboard API (`navigator.clipboard`)
- **Legacy browsers**: Falls back to `document.execCommand('copy')`
- **Non-secure contexts**: Automatically uses fallback method

<p>The Clipboard API requires a secure context (HTTPS) in most browsers. The hook automatically detects this and uses the appropriate method.</p>

## Best Practices

1. **User Feedback**: Always provide visual feedback when copying succeeds
2. **Error Handling**: Handle potential failures gracefully
3. **Accessibility**: Consider adding ARIA labels for screen readers
4. **Performance**: The hook uses `useCallback` to prevent unnecessary re-renders

## Troubleshooting

#### **Copy Not Working**

- Ensure you're in a secure context (HTTPS) for the Clipboard API
- Check browser permissions for clipboard access
- Verify the element is focused when using fallback method

#### **State Not Updating**

- The `copied` state automatically resets after 2 seconds
- Make sure you're not overriding the state externally
